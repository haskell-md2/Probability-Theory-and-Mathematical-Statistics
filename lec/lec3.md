<span style="color: red;">Статья незаконченна и всё ещё дополняется</span>

# Лекция 3, 16.09.2025*

> *Домовница (Мученица Домна). На Домовницу женщины выносили из избы хлам — выманивают благополучие на осень. Избавлялись, однако, далеко не от всего старья — некоторые вещи, служившие верой и правдой семье и дому, становились оберегами.

На прошлой лекции мы показали, что в эксперименте с $N$ шарами двух цветов, при стремлении количества шаров $N$ к бесконечности и при постоянной доле шаров одного цвета, вероятность вытянуть $k$ белых шаров будет стремится к геометрическому распределению (к распределению Бернулли). На этой лекции начнем с обобщения этого результата. 

## Полиномиальная вероятностная схема

Рассмотрим такой эксперимент:
>* проводится $n$ - независимых испытаний 
>* у каждого испытания есть $m$ - альтернативных исходов 
>* вероятность $j$-ого исхода в одном конкретном испытании равна $p_j$ $ j=\overline{1,m} ,\ (p_1> 0,\ p_2> 0, \ldots, p_m>0; \ p_1 +\ldots + p_m = 1 )$

Заметим, что в биномиальной схеме исходов было всего 2 -- успех и неудача. Здесь же будет $m$ разных исходов. У каждого из них будет разная вероятность произойти. 

Пусть в одной серии эксперимента произошел:

исход 1 - $k_1$ раз 

исход 2 - $k_2$ раза

...

исход m - $k_m$ раз

Тогда $k_1 + k_2 + \ldots + k_m = n$. Получается, что каждую серию испытаний можно представить в виде $m$-ичного числа с $n$ цифрами: 
$$\overline{a_1a_2a_3\ldots a_n},$$
где каждое $a_j$ -- показывает, какой из $m$ возможных исходов произошел в испытании с номером $j$.
Поэтому, ясно что вероятность одной серии будет вычисляться так: 
$$p_1^{k_1}\cdot p_2^{k_2}\cdot \ldots \cdot p_m^{k_m}$$
Теперь, по аналогии с биномиальной схемой, найдем вероятность получить любую серию, где каждый $j$-ый исход произошел ровно $k_j$ раз:
$$P(S_n^{(1)} = k_1,\ \ldots S_n^{(m)} = k_m) = $$
$$ = C_n^{k_1}\cdot C_{n-k_1}^{k_2}\cdot C_{n-k_1-k_2}^{k_3}\cdot \ldots \cdot C_{n-k_1-\ldots - k_{m-1}}^{k_m}\cdot  p_1^{k_1}\cdot p_2^{k_2}\cdot p_3^{k_3}\cdot \ldots \cdot p_m^{k_m}$$
Поясним. Мы уже знаем, что вероятность получить конкретное $m$-ичное число (то есть конкретную серию) равна $p_1^{k_1}\cdot p_2^{k_2}\cdot \ldots \cdot p_m^{k_m}$. Нам нужны все такие серии: 
количество способов выбрать $k_1$ позиций для исхода $1$ из $n$ позиций  -- это $C_n^{k_1}$
количество способов выбрать $k_2$ позиций для исхода $2$ из $n-k_1$ позиций -- это $C_{n-k_1}^{k_2}$
количество способов выбрать $k_3$ позиций для исхода $3$ из $n-k_1-k_2$ позиций -- это $C_{n-k_1-k_2}^{k_3}$
...
количество способов выбрать $k_m$ позиций для исхода $m$ из $n-k_1-\ldots - k_{m-1}$ позиций -- это $C_{n-k_1-\ldots - k_{m-1}}^{k_m}$

Тогда если преобразовать биномиальные коэффициенты, то получится: 
$$P(S_n^{(1)} = k_1,\ \ldots S_n^{(m)} = k_m) = \frac{n!}{k_1!k_2!\ldots k_m!}p_1^{k_1}\cdot p_2^{k_2}\cdot p_3^{k_3}\cdot \ldots \cdot p_m^{k_m}$$
Это выражения для полиномиального коэффициента. Оно появляется если расписать $n$-ую степень суммы: 
$$(p_1+p_1+\ldots + p_m)^n = \sum_{k_1+\ldots+k_m=n,\ k_j\geq 0 } \frac{n!}{k_1!k_2!\ldots k_m!}p_1^{k_1}\cdot p_2^{k_2}\cdot p_3^{k_3}\cdot \ldots \cdot p_m^{k_m}$$

Заметим, что также как и для биномиальной схемы, здесь можно показать, что, при стремлении общего числа испытаний к бесконечности и при постоянной доли каждого исхода, эта вероятность будет стремится к полиномиальному распределению. 

## Биномиальная схема $p=q=\frac{1}{2}$. Поиск наиболее вероятного исхода

AAAAAAAAAAAAAAAAAAAAA

## Предельные теоремы для биномиальной схемы
Как можно заметить, вычислять вероятности для биномиальной схемы может быть довольно трудно. Это будет особенно трудно, если $n\rightarrow\infty$. Поэтому существуют предельные теоремы, которые помогают находить вероятности при очень больших значениях $n$. 


### Теорема Пуассона
> Теорема (Пуассона)

Рассмотрим биномиальную схему. Пусть проводится $n$ испытаний, вероятность успеха $p_n$. Она будет уменьшаться с ростом $n$ но так, что общая доля успехов падает: 
$$n\rightarrow\infty,\ p_n\rightarrow 0, \text{ но } np\rightarrow \lambda > 0 $$
Тогда вероятность получить ровно $k$ удач будет иметь предел: 
$$P(S_n=k)\rightarrow \frac{\lambda}{k!}e^{-\lambda}$$

> Доказательство

Пусть $np_n = \lambda$, тогда $p=\frac{\lambda}{n}$. Заметим, что в этом случае результат теоремы доказывается простыми преобразованиями: 

$$P(S_n=k) = C_n^k p^kq^{n-k} = C_n^k \left(\frac{\lambda}{n}\right)^k \left(1-\frac{\lambda}{n}\right)^{n-k} = \frac{n!}{k!(n-k)!} \left(\frac{\lambda}{n}\right)^k \left(1-\frac{\lambda}{n}\right)^{n-k} = $$
$$=
\frac{\lambda^k}{k!} 
\underbrace{\frac{n(n-1)\ldots (n-k+1)}{n\cdot n \cdot\ldots \cdot n [\leftarrow k\text{ раз по }n]}}_{\rightarrow 1} 
\underbrace{\left(1-\frac{\lambda}{n}\right)^{-k}}_{\rightarrow 1}
\underbrace{\left(1-\frac{\lambda}{n}\right)^{n}}_{\rightarrow e^{-\lambda}} \rightarrow  \frac{\lambda}{k!}e^{-\lambda}
$$

Сейчас мы рассмотрели только один частный случай, когда вероятность успеха и количество испытаний пропорциональны: $np_n=\lambda$. Однако несложно понять, что и в общем случае, когда $np_n \rightarrow \lambda$ доказательство не изменится. В преобразования всего лишь добавятся $o$-малые:
$$
np=\lambda + o(1)
\Rightarrow
n = \frac{\lambda}{n} +o\left(\frac{1}{n}\right) 
\Rightarrow
$$
$$
\Rightarrow
P(S_n=k) = C_n^k \left(\frac{\lambda}{n} + o\left(\frac{1}{n}\right)\right)^k \left(1-\frac{\lambda}{n} + o\left(\frac{1}{n}\right)\right)^{n-k} 
\Rightarrow
\text{и т.д.}\ldots
$$

> Замечание

На практике теорему Пуассона применяют при следующих условиях: 
$$n>>1,\ np=\lambda \approx 1$$

Существует также отдельная теорема для того чтобы оценить погрешность, которая получается при использовании теоремы Пуассона: 

> Теорема (о погрешности)

$$\left| P(S_n =k, \forall k = \overline{0,n}) - \sum_{k=0}^n \frac{(np)^k}{k!}e^{-np}\right|\leq np^2$$


### Локальная теорема Муавра-Лапласа

Для биномиального распределения есть еще одна теорема, которая позволяет вычислять вероятности при больших $n$.
> Теорема (локальная теорема Муавра-Лапласа)

Пусть в биномиальной схеме $p\approx q,\ npq >>1 $. Тогда:
$$P(S_n = k) \approx
\frac{e^{-\frac{1}{2}\left( \frac{k-np}{\sqrt{npq}}\right)^2}}{\sqrt{2\pi npq}} = 
\frac{e^{-\frac{1}{2} \frac{(k-np)^2}{npq}}} {\sqrt{2\pi npq}}$$
Заметим, что мы будем доказывать примерное равенство -- то есть асимптотику. На самом деле, в условии теоремы можно поставить предел, но это сделает доказательство теоремы более сложным, а результата с асимптотикой нам будет достаточно. 

> Доказательство 

Введем параметр $x_k$:
$$x_k = \frac{k}{n} - p$$
Мы будем рассматривать значения $k$ не очень далёкие от наивероятнейшего. Тогда:
$$x_k\rightarrow 0, \text{ при } n\rightarrow \infty$$
Вспомним формулу Стирлинга: 
$$n! = \sqrt{2\pi n} \cdot n^n e^{-n}(1 + o(1))$$
По ней распишем биномиальный коэффициент $C_n^k$:
$$C_n^k = \frac{n!}{k!(n-k)!}=\frac{\sqrt{2\pi n} n^n e^{-n}}{\sqrt{2\pi k} k^k e^{-k}\cdot \sqrt{2\pi (n-k)} (n-k)^{(n-k)} e^{-(n-k)}} =$$
$$ = \sqrt{\frac{n}{2\pi k (n-k)}} \left( \frac{n}{k}\right)^k  \left( \frac{n}{n - k}\right)^{n-k}$$
Теперь подставим это в выражение для $P(S_n=k)$:
$$P(S_n=k) = C_n^k p^kq^{n-k} = \sqrt{\frac{n}{2\pi k (n-k)}} \left( \frac{pn}{k}\right)^k  \left( \frac{qn}{n - k}\right)^{n-k}$$
Из определения $x_k$ можно получить: $k = n(p+x_k),\ n-k = n(q-x_k)$. Подставим это в выражение для $P(S_n = k)$:
$$P(S_n = k) = 
\sqrt{\frac{n}{2\pi k (n-k)}} \left( \frac{\boxed{k}}{pn}\right)^{-\boxed{k}}  \left( \frac{\boxed{n-k}}{qn}\right)^{-\left(\boxed{n-k}\right)} = $$
$$=
\sqrt{\frac{n}{2\pi k (n-k)}} \underbrace{\left( 1 + \frac{x_k}{p}\right)^{-n(p+x_k)}  \left( 1 - \frac{x_n}{q}\right)^{-n(q-x_k)}}_{=\Pi} 
$$
Возьмем логарифм от $\Pi$:
$$\ln\Pi = -n\left[ 
(p + x_k) \ln\left( 1 + \frac{x_k}{p}\right) +  
(q - x_k) \ln\left( 1 - \frac{x_k}{q}\right)
\right] $$
Разложим каждый из логарифмов внутри скобок в ряд:
$$\ln\Pi = -n\left[ 
(p + x_k) \left( \frac{x_k}{p} - \frac{x_k^2}{2p^2} + \frac{x_k^3}{3p^3}-\ldots\right) +  
(q - x_k) \left(-\frac{x_k}{q} - \frac{x_k^2}{2q^2} - \frac{x_k^3}{3q^3}-\ldots\right)
\right] $$
Теперь раскрываем скобки и располагаем члены суммы по степеням $x_k$: 
$$\ln\Pi = -n\left[ 
\left( x_k - x_k \right) +
\left( \frac{x_k^2}{p} - \frac{x_k^2}{2p} + \frac{x_k^2}{q} -\frac{x_k^2}{2q} \right) +  
\left( \frac{x_k^3}{3p^2} - \frac{x_k^3}{2p^2} - \frac{x_k^3}{3q^2} + \frac{x_k^3}{2q^2}\right) + 
\ldots
\right] = $$
$$=
-n\left[ 
\frac{x_k^2}{2} \left( \frac{1}{p} + \frac{1}{q} \right) +  
\frac{x_k^3}{6} \left( \frac{1}{p^2} - \frac{1}{q^2} \right) + 
\ldots
\right]
$$
Мы будем считать, что $nx_k ^3 \rightarrow 0$, при $n\rightarrow 0$. Тогда можно пренебречь слагаемым с $x_k ^3$ и получить: 
$$\ln\Pi \approx -\frac{nx_k^2}{2}\cdot\frac{1}{pq} $$
(На самом деле вовсе не обязательно дополнительно требовать, что $nx_k ^3 \rightarrow 0$. Можно просто сказать, что $nx_k^3 = o(nx_k^2)$, так как $x_k \rightarrow 0$)

Тогда $\Pi$ будет примерно равно:
$$\Pi \approx e ^{-\frac{nx_k^2}{2}\cdot\frac{1}{pq}}$$

В выражении для $P(S_n = k)$ преобразуем и множитель перед $\Pi$:
$$\sqrt{\frac{n}{2\pi k (n-k)}} = 
\frac{1}{\sqrt{2\pi n \frac{k}{n}  \frac{n-k}{n}}} = 
\frac{1}{\sqrt{2\pi n (p + x_k)  (q - x_k)}} \approx
\frac{1}{\sqrt{2\pi n p q}}, \text{ при } x_k \rightarrow 0$$
Теперь вернемся к самому выражению $P(S_n = k)$:

$$P(S_n = k) = \sqrt{\frac{n}{2\pi k (n-k)}} \cdot \Pi 
 \Longrightarrow
P(S_n = k) \approx \frac{1}{\sqrt{2\pi n p q}} e ^{-\frac{nx_k^2}{2}\cdot\frac{1}{pq}}$$
По определению $x_k = \frac{k-np}{n}$. Заменим его на эту дробь в показателе экспоненты и получим условие теоремы: 
$$P(S_n = k) \approx
\frac{e^{-\frac{1}{2} \frac{(k-np)^2}{npq}}} {\sqrt{2\pi npq}}$$

> Замечание

В предположениях предыдущей теоремы можно сделать замену:
$$\frac{1}{\sigma^2} = \frac{n}{pq} 
\Rightarrow 
\sigma =\sqrt{\frac{pq}{n}}$$
Тогда выражение $P(S_n = k)$ перепишется в виде:
$$P(S_n = k) \approx
\frac{1}{n} \frac{e^{ -\frac{x_k^2}{2\sigma^2}}}{\sigma\sqrt{2\pi}} $$

> Следствие

Рассмотрим интегральную Теорему Муавра-Лапласа. Пусть надо найти вероятность того, что $S_n$ находится между $k_1$ и $k_2$. Эта вероятность найдется по формуле: 
$$P(k_1\leq S_n\leq k_2) = 
P\left(\frac{k_1 - np}{\sqrt{npq}} \leq \frac{S_n - np}{\sqrt{npq}}\leq \frac{k_2 - np}{\sqrt{npq}} \right) \approx
\int\limits_\frac{k_1 - np}{\sqrt{npq}}^\frac{k_2 - np}{\sqrt{npq}}
\ \frac{e^{-\frac{t^2}{2}}}{\sqrt{2\pi}} \ dt$$

> Объяснение

Точного доказательства на этом этапе мы приводить не будем. Покажем лишь его идею. Будем пользоваться локальной теоремой. Мы знаем, что при конкретном значении $k$ вероятность $P(S_n = k)$ будет примерно равна: 
$$P(S_n = k) \approx \frac{1}{n} \frac{e^{ -\frac{x_k^2}{2\sigma^2}}}{\sigma\sqrt{2\pi}}$$
Здесь дробь $\frac{1}{n}$ будет играть роль малого шага $\Delta x_k$ для интегральной суммы на отрезке $[k_1,\ k_2]$. Тогда, если провести все должные замены переменных, просуммировать и устремить $n$ к бесконечности, то получим: 
$$P(k_1\leq S_n\leq k_2) \approx
\int\limits_\frac{k_1 - np}{\sqrt{npq}}^\frac{k_2 - np}{\sqrt{npq}}
\ \frac{e^{-\frac{t^2}{2}}}{\sqrt{2\pi}} \ dt$$